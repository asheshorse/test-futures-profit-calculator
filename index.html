<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœŸè´§å†å²ç›ˆåˆ©å›æµ‹å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', 'Segoe UI', sans-serif;
        }
      
        body {
            background: linear-gradient(135deg, #1a237e, #283593, #3949ab);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
      
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
      
        header {
            text-align: center;
            padding: 30px 0;
            color: white;
        }
      
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
      
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
        }
      
        .panel {
            background: rgba(255, 255, 255, 0.92);
            border-radius: 15px;
            padding: 30px;
            margin: 25px 0;
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }
      
        .panel-title {
            font-size: 1.8rem;
            color: #1a237e;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }
      
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
      
        .form-group {
            display: flex;
            flex-direction: column;
        }
      
        .form-group label {
            font-weight: bold;
            margin-bottom: 8px;
            color: #444;
            display: flex;
            align-items: center;
            gap: 8px;
        }
      
        .form-group input, 
        .form-group select {
            padding: 14px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1.05rem;
            transition: all 0.3s;
            background: #f8f9fa;
        }
      
        .form-group input:focus, 
        .form-group select:focus {
            outline: none;
            border-color: #3949ab;
            box-shadow: 0 0 8px rgba(57, 73, 171, 0.3);
        }
      
        .calc-results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 25px 0;
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
        }
      
        .result-box {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.08);
        }
      
        .result-label {
            font-size: 0.95rem;
            color: #555;
            margin-bottom: 8px;
        }
      
        .result-value {
            font-size: 1.4rem;
            font-weight: bold;
            color: #1a237e;
        }
      
        .result-warning {
            color: #e53935;
            font-weight: bold;
        }
      
        .btn-container {
            text-align: center;
            margin: 30px 0 20px;
        }
      
        .btn {
            padding: 16px 45px;
            background: #3949ab;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
      
        .btn:hover {
            background: #283593;
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.25);
        }
      
        .btn:active {
            transform: translateY(0);
        }
      
        .btn-reset {
            background: #e53935;
            margin-left: 15px;
        }
      
        .btn-reset:hover {
            background: #c62828;
        }
      
        .result-table-container {
            overflow-x: auto;
            margin-top: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
      
        .result-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            min-width: 800px;
        }
      
        .result-table th {
            background: #1a237e;
            color: white;
            padding: 16px 12px;
            text-align: center;
            font-weight: bold;
        }
      
        .result-table td {
            padding: 14px 12px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }
      
        .result-table tr:nth-child(even) {
            background: #f5f7ff;
        }
      
        .result-table tr:hover {
            background: #e3f2fd;
        }
      
        .result-table .profit {
            color: #388e3c;
            font-weight: bold;
        }
      
        .result-table .loss {
            color: #e53935;
            font-weight: bold;
        }
      
        .result-table .total-row {
            background: #e3f2fd;
            font-weight: bold;
            font-size: 1.1rem;
        }
      
        .summary {
            background: #e8f5e9;
            padding: 20px;
            border-radius: 10px;
            margin-top: 25px;
            border-left: 4px solid #388e3c;
        }
      
        .summary-title {
            font-size: 1.4rem;
            color: #1a237e;
            margin-bottom: 15px;
        }
      
        .summary-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
      
        .summary-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.08);
        }
      
        .summary-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #1a237e;
            margin: 8px 0;
        }
      
        .profit-summary {
            color: #388e3c;
        }
      
        footer {
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            padding: 30px 0 20px;
            font-size: 0.95rem;
        }
      
        @media (max-width: 768px) {
            h1 {
                font-size: 2.2rem;
            }
          
            .form-grid {
                grid-template-columns: 1fr;
            }
          
            .btn-container {
                display: flex;
                flex-direction: column;
                gap: 15px;
            }
          
            .btn-reset {
                margin-left: 0;
            }
        }
      
        @media (max-width: 480px) {
            .panel {
                padding: 20px 15px;
            }
          
            h1 {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>æœŸè´§å†å²ç›ˆåˆ©å›æµ‹å™¨</h1>
            <p class="subtitle">é€šè¿‡å†å²æ•°æ®æ¨¡æ‹Ÿæ‚¨çš„æœŸè´§äº¤æ˜“ç­–ç•¥ï¼Œåˆ†æä¸åŒåŠ ä»“æ–¹å¼ä¸‹çš„ç›ˆåˆ©æƒ…å†µ</p>
        </header>
      
        <div class="panel">
            <h2 class="panel-title">æœŸè´§å‚æ•°è®¾ç½®</h2>
          
            <div class="form-grid">
                <div class="form-group">
                    <label for="futures-type">ğŸ“Š æœŸè´§å“ç§</label>
                    <select id="futures-type">
                        <option value="">-- è¯·é€‰æ‹©æœŸè´§å“ç§ --</option>
                        <option value="cu" data-multiplier="5">é“œ (CU) - 5å¨/æ‰‹</option>
                        <option value="al" data-multiplier="5">é“ (AL) - 5å¨/æ‰‹</option>
                        <option value="zn" data-multiplier="5">é”Œ (ZN) - 5å¨/æ‰‹</option>
                        <option value="au" data-multiplier="1000">é»„é‡‘ (AU) - 1000å…‹/æ‰‹</option>
                        <option value="ag" data-multiplier="15">ç™½é“¶ (AG) - 15åƒå…‹/æ‰‹</option>
                        <option value="rb" data-multiplier="10">èºçº¹é’¢ (RB) - 10å¨/æ‰‹</option>
                        <option value="hc" data-multiplier="10">çƒ­è½§å·æ¿ (HC) - 10å¨/æ‰‹</option>
                        <option value="fu" data-multiplier="10">ç‡ƒæ–™æ²¹ (FU) - 10å¨/æ‰‹</option>
                        <option value="bu" data-multiplier="10">çŸ³æ²¹æ²¥é’ (BU) - 10å¨/æ‰‹</option>
                        <option value="ru" data-multiplier="10">å¤©ç„¶æ©¡èƒ¶ (RU) - 10å¨/æ‰‹</option>
                    </select>
                </div>
              
                <div class="form-group">
                    <label for="open-type">ğŸ“ˆ å¼€ä»“æ–¹å¼</label>
                    <select id="open-type">
                        <option value="">-- è¯·é€‰æ‹©å¼€ä»“æ–¹å¼ --</option>
                        <option value="long">å¤šå¼€ (ä¹°å…¥å¼€ä»“)</option>
                        <option value="short">ç©ºå¼€ (å–å‡ºå¼€ä»“)</option>
                    </select>
                </div>
              
                <div class="form-group">
                    <label for="margin-rate">ğŸ’° ä¿è¯é‡‘ç‡ (%)</label>
                    <input type="number" id="margin-rate" min="5" max="100" step="1" value="10" placeholder="è¾“å…¥ä¿è¯é‡‘ç‡">
                </div>
              
                <div class="form-group">
                    <label for="investment">ğŸ’µ è´­ä¹°é‡‘é¢ (å…ƒ)</label>
                    <input type="number" id="investment" min="1000" step="1000" value="100000" placeholder="è¾“å…¥è´­ä¹°é‡‘é¢">
                </div>
              
                <div class="form-group">
                    <label for="open-price">âš–ï¸ å¼€ä»“ä»·æ ¼</label>
                    <input type="number" id="open-price" min="1" step="0.01" value="5000" placeholder="å¼€ä»“ä»·æ ¼">
                </div>
              
                <div class="form-group">
                    <label for="close-price">ğŸ“‰ å¹³ä»“ä»·æ ¼</label>
                    <input type="number" id="close-price" min="1" step="0.01" value="5500" placeholder="å¹³ä»“ä»·æ ¼">
                </div>
              
                <div class="form-group">
                    <label for="add-position-type">ğŸ“¦ æµ®ç›ˆåŠ ä»“æ–¹å¼</label>
                    <select id="add-position-type">
                        <option value="">-- è¯·é€‰æ‹©åŠ ä»“æ–¹å¼ --</option>
                        <option value="pyramid">å€’é‡‘å­—å¡”åŠ ä»“</option>
                        <option value="percent">æ¯æ¶¨10%åŠ ä»“</option>
                    </select>
                </div>
            </div>
          
            <div class="calc-results">
                <div class="result-box">
                    <div class="result-label">äº¤æ˜“ä¹˜æ•°</div>
                    <div class="result-value" id="multiplier-result">--</div>
                </div>
              
                <div class="result-box">
                    <div class="result-label">å¹³ä»“æ–¹å¼</div>
                    <div class="result-value" id="close-type-result">--</div>
                </div>
              
                <div class="result-box">
                    <div class="result-label">ä¸€æ‰‹ä¿è¯é‡‘</div>
                    <div class="result-value" id="margin-per-lot">--</div>
                </div>
              
                <div class="result-box">
                    <div class="result-label">æœ€å¤§å¯ä¹°æ‰‹æ•°</div>
                    <div class="result-value" id="max-lots">--</div>
                </div>
            </div>
          
            <div class="btn-container">
                <button class="btn" id="calculate-btn">å¼€å§‹å›æµ‹è®¡ç®—</button>
                <button class="btn btn-reset" id="reset-btn">é‡ç½®å‚æ•°</button>
            </div>
        </div>
      
        <div class="panel" id="result-panel" style="display: none;">
            <h2 class="panel-title">å›æµ‹ç»“æœåˆ†æ</h2>
          
            <div class="result-table-container">
                <table class="result-table">
                    <thead>
                        <tr>
                            <th>æ“ä½œ</th>
                            <th>ä»·æ ¼</th>
                            <th>å¼€ä»“æ‰‹æ•°</th>
                            <th>ç´¯è®¡æ‰‹æ•°</th>
                            <th>æŒä»“å‡ä»·</th>
                            <th>æµ®åŠ¨ç›ˆäº</th>
                            <th>ç´¯è®¡ç›ˆäº</th>
                        </tr>
                    </thead>
                    <tbody id="result-table-body">
                        <!-- ç»“æœå°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </tbody>
                </table>
            </div>
          
            <div class="summary">
                <h3 class="summary-title">äº¤æ˜“æ€»ç»“</h3>
                <div class="summary-content" id="summary-content">
                    <!-- æ€»ç»“å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
      
        <footer>
            <p>Â© 2025 æœŸè´§å†å²ç›ˆåˆ©å›æµ‹å™¨ | æ•°æ®ä»…ä¾›å‚è€ƒï¼Œå®é™…äº¤æ˜“è¯·è°¨æ…å†³ç­–</p>
        </footer>
    </div>

    <script>
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // è·å–DOMå…ƒç´ 
            const futuresTypeSelect = document.getElementById('futures-type');
            const openTypeSelect = document.getElementById('open-type');
            const calculateBtn = document.getElementById('calculate-btn');
            const resetBtn = document.getElementById('reset-btn');
            const resultPanel = document.getElementById('result-panel');
          
            // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
            futuresTypeSelect.addEventListener('change', updateMultiplier);
            openTypeSelect.addEventListener('change', updateCloseType);
            calculateBtn.addEventListener('click', calculateResults);
            resetBtn.addEventListener('click', resetForm);
          
            // åˆå§‹åŒ–æ˜¾ç¤º
            updateMultiplier();
            updateCloseType();
        });
      
        // æ›´æ–°äº¤æ˜“ä¹˜æ•°
        function updateMultiplier() {
            const futuresTypeSelect = document.getElementById('futures-type');
            const multiplierResult = document.getElementById('multiplier-result');
          
            const selectedOption = futuresTypeSelect.options[futuresTypeSelect.selectedIndex];
            if (selectedOption.value) {
                const multiplier = selectedOption.getAttribute('data-multiplier');
                multiplierResult.textContent = multiplier + 'å…ƒ/ç‚¹';
            } else {
                multiplierResult.textContent = '--';
            }
        }
      
        // æ›´æ–°å¹³ä»“æ–¹å¼
        function updateCloseType() {
            const openTypeSelect = document.getElementById('open-type');
            const closeTypeResult = document.getElementById('close-type-result');
          
            if (openTypeSelect.value === 'long') {
                closeTypeResult.textContent = 'å¤šå¹³ (å–å‡ºå¹³ä»“)';
            } else if (openTypeSelect.value === 'short') {
                closeTypeResult.textContent = 'ç©ºå¹³ (ä¹°å…¥å¹³ä»“)';
            } else {
                closeTypeResult.textContent = '--';
            }
        }
      
        // è®¡ç®—ä¸€æ‰‹ä¿è¯é‡‘å’Œæœ€å¤§å¯ä¹°æ‰‹æ•°
        function calculateInitialParams() {
            const marginRate = parseFloat(document.getElementById('margin-rate').value) / 100;
            const investment = parseFloat(document.getElementById('investment').value);
            const openPrice = parseFloat(document.getElementById('open-price').value);
          
            const futuresTypeSelect = document.getElementById('futures-type');
            const selectedOption = futuresTypeSelect.options[futuresTypeSelect.selectedIndex];
            const multiplier = parseFloat(selectedOption.getAttribute('data-multiplier'));
          
            // è®¡ç®—ä¸€æ‰‹ä¿è¯é‡‘
            const marginPerLot = openPrice * multiplier * marginRate;
          
            // è®¡ç®—æœ€å¤§å¯ä¹°æ‰‹æ•°
            const maxLots = Math.floor(investment / marginPerLot);
          
            // æ›´æ–°æ˜¾ç¤º
            document.getElementById('margin-per-lot').textContent = marginPerLot.toFixed(2) + 'å…ƒ';
            document.getElementById('max-lots').textContent = maxLots + 'æ‰‹';
          
            if (maxLots < 1) {
                document.getElementById('max-lots').className = 'result-value result-warning';
                document.getElementById('max-lots').textContent += ' (ä¸è¶³1æ‰‹)';
            } else {
                document.getElementById('max-lots').className = 'result-value';
            }
          
            return {
                multiplier: multiplier,
                marginPerLot: marginPerLot,
                maxLots: maxLots
            };
        }
      
        // é‡ç½®è¡¨å•
        function resetForm() {
            document.getElementById('futures-type').selectedIndex = 0;
            document.getElementById('open-type').selectedIndex = 0;
            document.getElementById('margin-rate').value = 10;
            document.getElementById('investment').value = 100000;
            document.getElementById('open-price').value = 5000;
            document.getElementById('close-price').value = 5500;
            document.getElementById('add-position-type').selectedIndex = 0;
          
            updateMultiplier();
            updateCloseType();
          
            // é‡ç½®è®¡ç®—ç»“æœ
            document.getElementById('margin-per-lot').textContent = '--';
            document.getElementById('max-lots').textContent = '--';
            document.getElementById('max-lots').className = 'result-value';
          
            resultPanel.style.display = 'none';
        }
      
        // è®¡ç®—å›æµ‹ç»“æœ
        function calculateResults() {
            // éªŒè¯è¾“å…¥
            if (!validateInputs()) {
                return;
            }
          
            // è·å–åˆå§‹å‚æ•°
            const params = calculateInitialParams();
            if (params.maxLots < 1) {
                alert('è´­ä¹°é‡‘é¢ä¸è¶³å¼€ä»“1æ‰‹ï¼Œè¯·å¢åŠ æŠ•èµ„é‡‘é¢');
                return;
            }
          
            // è·å–å…¶ä»–å‚æ•°
            const openType = document.getElementById('open-type').value;
            const openPrice = parseFloat(document.getElementById('open-price').value);
            const closePrice = parseFloat(document.getElementById('close-price').value);
            const addPositionType = document.getElementById('add-position-type').value;
          
            // è®¡ç®—åŠ ä»“æ¬¡æ•°å’Œä»·æ ¼
            const priceChange = Math.abs(closePrice - openPrice);
            const priceStep = openPrice * 0.1; // 10%çš„ä»·æ ¼å˜åŒ–
            const steps = Math.min(Math.floor(priceChange / priceStep), 5); // æœ€å¤š5æ¬¡åŠ ä»“
          
            // åˆ›å»ºäº¤æ˜“è®°å½•
            const transactions = [];
            let totalLots = 0;
            let totalCost = 0;
            let totalProfit = 0;
            let cumulativeProfit = 0;
          
            // åˆå§‹å¼€ä»“
            const initialLots = params.maxLots;
            totalLots = initialLots;
            totalCost = initialLots * openPrice;
            const avgPrice = totalCost / totalLots;
          
            // è®¡ç®—åˆå§‹ç›ˆäº
            let profit = calculateProfit(openType, openPrice, closePrice, initialLots, params.multiplier);
            cumulativeProfit += profit;
          
            transactions.push({
                operation: 'åˆå§‹å¼€ä»“',
                price: openPrice,
                lots: initialLots,
                totalLots: totalLots,
                avgPrice: avgPrice,
                profit: profit,
                cumulativeProfit: cumulativeProfit
            });
          
            // æ¨¡æ‹ŸåŠ ä»“æ“ä½œ
            let lastPrice = openPrice;
            let lastLots = initialLots;
          
            for (let i = 1; i <= steps; i++) {
                // ç¡®å®šåŠ ä»“ä»·æ ¼
                const addPrice = openType === 'long' ? 
                    openPrice + (priceStep * i) : 
                    openPrice - (priceStep * i);
              
                // ç¡®å®šåŠ ä»“æ‰‹æ•°
                let addLots;
                if (addPositionType === 'pyramid') {
                    // å€’é‡‘å­—å¡”åŠ ä»“ï¼šæ¯æ¬¡åŠ ä»“æ‰‹æ•°å‡åŠ
                    addLots = Math.max(Math.floor(lastLots / 2), 1);
                } else {
                    // æ¯æ¶¨10%åŠ ä»“ï¼šæ¯æ¬¡åŠ ä»“æ‰‹æ•°ç­‰äºåˆå§‹æ‰‹æ•°
                    addLots = initialLots;
                }
              
                // æ›´æ–°æŒä»“
                totalLots += addLots;
                totalCost += addPrice * addLots;
                const newAvgPrice = totalCost / totalLots;
              
                // è®¡ç®—æœ¬æ¬¡åŠ ä»“çš„æµ®åŠ¨ç›ˆäº
                profit = calculateProfit(openType, newAvgPrice, addPrice, totalLots, params.multiplier);
                cumulativeProfit += calculateProfit(openType, lastPrice, addPrice, lastLots, params.multiplier);
              
                transactions.push({
                    operation: `ç¬¬${i}æ¬¡åŠ ä»“`,
                    price: addPrice,
                    lots: addLots,
                    totalLots: totalLots,
                    avgPrice: newAvgPrice,
                    profit: profit,
                    cumulativeProfit: cumulativeProfit
                });
              
                lastPrice = addPrice;
                lastLots = totalLots;
            }
          
            // æœ€ç»ˆå¹³ä»“
            const finalProfit = calculateProfit(openType, avgPrice, closePrice, totalLots, params.multiplier);
            cumulativeProfit += calculateProfit(openType, lastPrice, closePrice, totalLots, params.multiplier);
          
            transactions.push({
                operation: 'æœ€ç»ˆå¹³ä»“',
                price: closePrice,
                lots: totalLots,
                totalLots: 0,
                avgPrice: 0,
                profit: finalProfit,
                cumulativeProfit: cumulativeProfit
            });
          
            // æ˜¾ç¤ºç»“æœ
            displayResults(transactions, params);
        }
      
        // è®¡ç®—å•æ¬¡ç›ˆäº
        function calculateProfit(openType, avgPrice, currentPrice, lots, multiplier) {
            if (openType === 'long') {
                return (currentPrice - avgPrice) * lots * multiplier;
            } else {
                return (avgPrice - currentPrice) * lots * multiplier;
            }
        }
      
        // éªŒè¯è¾“å…¥
        function validateInputs() {
            const futuresType = document.getElementById('futures-type').value;
            const openType = document.getElementById('open-type').value;
            const marginRate = document.getElementById('margin-rate').value;
            const investment = document.getElementById('investment').value;
            const openPrice = document.getElementById('open-price').value;
            const closePrice = document.getElementById('close-price').value;
            const addPositionType = document.getElementById('add-position-type').value;
          
            if (!futuresType) {
                alert('è¯·é€‰æ‹©æœŸè´§å“ç§');
                return false;
            }
          
            if (!openType) {
                alert('è¯·é€‰æ‹©å¼€ä»“æ–¹å¼');
                return false;
            }
          
            if (!marginRate || marginRate <= 0 || marginRate > 100) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„ä¿è¯é‡‘ç‡ (0-100)');
                return false;
            }
          
            if (!investment || investment <= 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„è´­ä¹°é‡‘é¢');
                return false;
            }
          
            if (!openPrice || openPrice <= 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„å¼€ä»“ä»·æ ¼');
                return false;
            }
          
            if (!closePrice || closePrice <= 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„å¹³ä»“ä»·æ ¼');
                return false;
            }
          
            if (!addPositionType) {
                alert('è¯·é€‰æ‹©åŠ ä»“æ–¹å¼');
                return false;
            }
          
            return true;
        }
      
        // æ˜¾ç¤ºç»“æœ
        function displayResults(transactions, params) {
            const resultPanel = document.getElementById('result-panel');
            const tableBody = document.getElementById('result-table-body');
            const summaryContent = document.getElementById('summary-content');
          
            // æ¸…ç©ºè¡¨æ ¼
            tableBody.innerHTML = '';
            summaryContent.innerHTML = '';
          
            // å¡«å……è¡¨æ ¼
            transactions.forEach(trans => {
                const row = document.createElement('tr');
              
                // ä¸ºæœ€åä¸€è¡Œæ·»åŠ ç‰¹æ®Šæ ·å¼
                if (trans.operation === 'æœ€ç»ˆå¹³ä»“') {
                    row.className = 'total-row';
                }
              
                // æ ¼å¼åŒ–ç›ˆäºæ˜¾ç¤º
                const profitClass = trans.profit >= 0 ? 'profit' : 'loss';
                const profitText = trans.profit >= 0 ? 
                    `+${trans.profit.toFixed(2)}` : 
                    trans.profit.toFixed(2);
              
                const cumulativeProfitClass = trans.cumulativeProfit >= 0 ? 'profit' : 'loss';
                const cumulativeProfitText = trans.cumulativeProfit >= 0 ? 
                    `+${trans.cumulativeProfit.toFixed(2)}` : 
                    trans.cumulativeProfit.toFixed(2);
              
                row.innerHTML = `
                    <td>${trans.operation}</td>
                    <td>${trans.price.toFixed(2)}</td>
                    <td>${trans.lots}</td>
                    <td>${trans.totalLots}</td>
                    <td>${trans.avgPrice ? trans.avgPrice.toFixed(2) : '--'}</td>
                    <td class="${profitClass}">${profitText}</td>
                    <td class="${cumulativeProfitClass}">${cumulativeProfitText}</td>
                `;
              
                tableBody.appendChild(row);
            });
          
            // åˆ›å»ºæ€»ç»“
            const finalTransaction = transactions[transactions.length - 1];
          
            summaryContent.innerHTML = `
                <div class="summary-item">
                    <div>æ€»äº¤æ˜“æ¬¡æ•°</div>
                    <div class="summary-value">${transactions.length - 1}</div>
                    <div>åˆå§‹å¼€ä»“ + ${transactions.length - 2}æ¬¡åŠ ä»“ + æœ€ç»ˆå¹³ä»“</div>
                </div>
              
                <div class="summary-item">
                    <div>æœ€å¤§æŒä»“æ‰‹æ•°</div>
                    <div class="summary-value">${Math.max(...transactions.slice(0, -1).map(t => t.totalLots))}</div>
                    <div>äº¤æ˜“ä¹˜æ•°: ${params.multiplier}å…ƒ/ç‚¹</div>
                </div>
              
                <div class="summary-item">
                    <div>æœ€ç»ˆç›ˆåˆ©</div>
                    <div class="summary-value profit-summary">${finalTransaction.cumulativeProfit >= 0 ? '+' : ''}${finalTransaction.cumulativeProfit.toFixed(2)}å…ƒ</div>
                    <div>æ”¶ç›Šç‡: ${((finalTransaction.cumulativeProfit / parseFloat(document.getElementById('investment').value)) * 100).toFixed(2)}%</div>
                </div>
            `;
          
            // æ˜¾ç¤ºç»“æœé¢æ¿
            resultPanel.style.display = 'block';
          
            // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
            resultPanel.scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>
