<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>期货历史盈利回测器</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', 'Segoe UI', sans-serif;
        }
      
        body {
            background: linear-gradient(135deg, #1a2a6c, #2c3e50);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
      
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
      
        header {
            text-align: center;
            padding: 30px 0;
            color: white;
        }
      
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
      
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }
      
        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-top: 20px;
        }
      
        @media (max-width: 992px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
      
        .input-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.2);
        }
      
        .result-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.2);
            max-height: 80vh;
            overflow-y: auto;
        }
      
        .form-group {
            margin-bottom: 20px;
        }
      
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }
      
        select, input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }
      
        select:focus, input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 8px rgba(52, 152, 219, 0.5);
        }
      
        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 14px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            width: 100%;
            transition: all 0.3s;
            margin-top: 10px;
        }
      
        .btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
      
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #3498db;
            padding: 15px;
            border-radius: 0 8px 8px 0;
            margin-top: 10px;
            display: none;
        }
      
        .info-box p {
            margin: 5px 0;
            font-size: 0.95rem;
        }
      
        .info-highlight {
            color: #e74c3c;
            font-weight: bold;
        }
      
        .table-container {
            margin-top: 20px;
            overflow-x: auto;
        }
      
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
      
        th, td {
            padding: 12px 15px;
            text-align: center;
            border-bottom: 1px solid #ddd;
        }
      
        th {
            background-color: #3498db;
            color: white;
            position: sticky;
            top: 0;
        }
      
        tr:nth-child(even) {
            background-color: #f5f9ff;
        }
      
        tr:hover {
            background-color: #e3f2fd;
        }
      
        .profit-positive {
            color: #27ae60;
            font-weight: bold;
        }
      
        .profit-negative {
            color: #e74c3c;
            font-weight: bold;
        }
      
        .summary {
            margin-top: 20px;
            padding: 15px;
            background: #e3f2fd;
            border-radius: 8px;
            font-size: 1.1rem;
        }
      
        .summary-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
            text-align: center;
            font-size: 1.2rem;
        }
      
        .summary-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
      
        .summary-item {
            padding: 10px;
            background: white;
            border-radius: 8px;
            text-align: center;
        }
      
        .summary-value {
            font-size: 1.3rem;
            font-weight: bold;
            margin-top: 5px;
        }
      
        .positive {
            color: #27ae60;
        }
      
        .negative {
            color: #e74c3c;
        }
      
        .section-title {
            font-size: 1.5rem;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
        }
      
        .result-placeholder {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
            font-style: italic;
        }
      
        .flex-row {
            display: flex;
            gap: 15px;
        }
      
        .flex-row > div {
            flex: 1;
        }
      
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
      
        .logo-icon {
            font-size: 2.5rem;
            color: #3498db;
        }
      
        .logo-text {
            font-size: 1.8rem;
            font-weight: bold;
            color: white;
        }
      
        footer {
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            padding: 20px;
            font-size: 0.9rem;
            margin-top: 30px;
        }
      
        @media (max-width: 768px) {
            h1 {
                font-size: 2.2rem;
            }
          
            .flex-row {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">📈</div>
                <div class="logo-text">期货历史盈利回测器</div>
            </div>
            <p class="subtitle">基于历史数据和交易策略的期货盈利回测工具</p>
        </header>
      
        <div class="main-content">
            <div class="input-section">
                <h2 class="section-title">交易参数设置</h2>
              
                <div class="form-group">
                    <label for="futures-type">期货品种</label>
                    <select id="futures-type">
                        <option value="">-- 请选择期货品种 --</option>
                        <!-- 期货品种选项将通过JavaScript动态生成 -->
                    </select>
                </div>
              
                <div class="form-group">
                    <label for="multiplier">交易乘数（交易单位）</label>
                    <input type="text" id="multiplier" readonly>
                </div>
              
                <div class="flex-row">
                    <div class="form-group">
                        <label for="open-type">开仓方式</label>
                        <select id="open-type">
                            <option value="long">多开</option>
                            <option value="short">空开</option>
                        </select>
                    </div>
                  
                    <div class="form-group">
                        <label for="close-type">平仓方式</label>
                        <input type="text" id="close-type" value="多平" readonly>
                    </div>
                </div>
              
                <div class="flex-row">
                    <div class="form-group">
                        <label for="margin-rate">保证金率 (%)</label>
                        <input type="number" id="margin-rate" min="1" max="100" step="0.5" value="10">
                    </div>
                  
                    <div class="form-group">
                        <label for="capital">购买金额 (元)</label>
                        <input type="number" id="capital" min="1000" step="1000" value="50000">
                    </div>
                </div>
              
                <div class="flex-row">
                    <div class="form-group">
                        <label for="open-price">开仓价格</label>
                        <input type="number" id="open-price" min="0.01" step="0.01" value="5000">
                    </div>
                  
                    <div class="form-group">
                        <label for="close-price">平仓价格</label>
                        <input type="number" id="close-price" min="0.01" step="0.01" value="5500">
                    </div>
                </div>
              
                <div class="form-group">
                    <label for="add-margin-type">浮盈加仓方式</label>
                    <select id="add-margin-type">
                        <option value="pyramid">倒金字塔加仓</option>
                        <option value="percent">每涨10%加仓</option>
                    </select>
                </div>
              
                <div id="calculation-info" class="info-box">
                    <p>一手所需保证金: <span id="margin-per-lot" class="info-highlight">0</span> 元</p>
                    <p>最大可买手数: <span id="max-lots" class="info-highlight">0</span> 手</p>
                    <p id="insufficient-warning" style="color: #e74c3c; display: none;">警告：可用资金不足购买一手！</p>
                </div>
              
                <button id="calculate-btn" class="btn">计算回测结果</button>
            </div>
          
            <div class="result-section">
                <h2 class="section-title">回测结果分析</h2>
              
                <div id="result-placeholder" class="result-placeholder">
                    <p>请设置交易参数并点击"计算回测结果"按钮</p>
                    <p>系统将根据您的策略生成历史回测数据</p>
                </div>
              
                <div id="result-content" style="display: none;">
                    <div class="table-container">
                        <table id="result-table">
                            <thead>
                                <tr>
                                    <th>操作类型</th>
                                    <th>开仓价格</th>
                                    <th>开仓手数</th>
                                    <th>平仓价格</th>
                                    <th>盈利金额</th>
                                    <th>累计盈利</th>
                                    <th>浮盈加仓方式</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- 结果表格将通过JavaScript动态生成 -->
                            </tbody>
                        </table>
                    </div>
                  
                    <div class="summary">
                        <div class="summary-title">交易策略汇总</div>
                        <div class="summary-content">
                            <div class="summary-item">
                                <div>初始投入资金</div>
                                <div class="summary-value" id="initial-capital">0 元</div>
                            </div>
                            <div class="summary-item">
                                <div>最终账户价值</div>
                                <div class="summary-value" id="final-value">0 元</div>
                            </div>
                            <div class="summary-item">
                                <div>总盈利金额</div>
                                <div class="summary-value" id="total-profit">0 元</div>
                            </div>
                            <div class="summary-item">
                                <div>总收益率</div>
                                <div class="summary-value" id="return-rate">0%</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
      
        <footer>
            <p>© 2025 期货历史盈利回测器 | 本工具仅用于历史数据回测，不构成投资建议 | 实际交易结果可能因市场波动而异</p>
        </footer>
    </div>

    <script>
        // 期货品种数据
        const futuresData = [
            { name: "白银", code: "ag", multiplier: 15 },
            { name: "黄金", code: "au", multiplier: 1000 },
            { name: "锰硅", code: "sm", multiplier: 5 },
            { name: "硅铁", code: "sf", multiplier: 5 },
            { name: "螺纹钢", code: "rb", multiplier: 10 },
            { name: "热卷", code: "hc", multiplier: 10 },
            { name: "铁矿石", code: "i", multiplier: 100 },
            { name: "不锈钢", code: "ss", multiplier: 5 },
            { name: "焦炭", code: "j", multiplier: 100 },
            { name: "焦煤", code: "jm", multiplier: 60 },
            { name: "纯碱", code: "sa", multiplier: 20 },
            { name: "玻璃", code: "fg", multiplier: 20 },
            { name: "PVC", code: "v", multiplier: 5 },
            { name: "塑料", code: "l", multiplier: 5 },
            { name: "橡胶", code: "ru", multiplier: 10 },
            { name: "甲醇", code: "ma", multiplier: 10 },
            { name: "纸浆", code: "sp", multiplier: 10 },
            { name: "烧碱", code: "sh", multiplier: 5 },
            { name: "原油", code: "sc", multiplier: 1000 },
            { name: "燃料油", code: "fu", multiplier: 10 },
            { name: "聚丙烯", code: "pp", multiplier: 5 },
            { name: "液化石油气", code: "pg", multiplier: 20 },
            { name: "尿素", code: "ur", multiplier: 20 },
            { name: "乙二醇", code: "eg", multiplier: 10 },
            { name: "原木", code: "lg", multiplier: 10 },
            { name: "PTA", code: "ta", multiplier: 5 },
            { name: "玉米", code: "c", multiplier: 10 },
            { name: "白糖", code: "sr", multiplier: 10 },
            { name: "棉花", code: "cf", multiplier: 5 },
            { name: "苹果", code: "ap", multiplier: 10 },
            { name: "生猪", code: "lh", multiplier: 16 },
            { name: "鸡蛋", code: "jd", multiplier: 5 },
            { name: "棕榈油", code: "p", multiplier: 10 },
            { name: "豆粕", code: "m", multiplier: 10 },
            { name: "豆油", code: "y", multiplier: 10 },
            { name: "菜粕", code: "rm", multiplier: 10 },
            { name: "菜油", code: "oi", multiplier: 10 },
            { name: "碳酸锂", code: "lc", multiplier: 1 },
            { name: "多晶硅", code: "ps", multiplier: 5 },
            { name: "锌", code: "zn", multiplier: 5 },
            { name: "工业硅", code: "si", multiplier: 5 },
            { name: "铜", code: "cu", multiplier: 5 },
            { name: "氧化铝", code: "ao", multiplier: 20 },
            { name: "锡", code: "sn", multiplier: 1 },
            { name: "镍", code: "ni", multiplier: 1 },
            { name: "铝", code: "al", multiplier: 5 },
            { name: "铅", code: "pb", multiplier: 5 },
            { name: "国际铜", code: "bc", multiplier: 5 },
            { name: "集运指数", code: "ec", multiplier: 50 }
        ];
      
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 填充期货品种下拉菜单
            const futuresSelect = document.getElementById('futures-type');
            futuresData.forEach(future => {
                const option = document.createElement('option');
                option.value = future.code;
                option.textContent = `${future.name} (${future.code})`;
                futuresSelect.appendChild(option);
            });
          
            // 默认选择第一个期货品种
            if (futuresData.length > 0) {
                futuresSelect.value = futuresData[0].code;
                updateMultiplier();
            }
          
            // 添加事件监听器
            futuresSelect.addEventListener('change', updateMultiplier);
            document.getElementById('open-type').addEventListener('change', updateCloseType);
            document.getElementById('calculate-btn').addEventListener('click', calculateResults);
          
            // 初始计算保证金
            calculateMargin();
          
            // 为输入框添加事件监听器，实时计算保证金
            const inputs = ['margin-rate', 'capital', 'open-price'];
            inputs.forEach(id => {
                document.getElementById(id).addEventListener('input', calculateMargin);
            });
        });
      
        // 更新交易乘数
        function updateMultiplier() {
            const futuresCode = document.getElementById('futures-type').value;
            const future = futuresData.find(f => f.code === futuresCode);
            if (future) {
                document.getElementById('multiplier').value = `${future.multiplier} 手/单位`;
                calculateMargin();
            }
        }
      
        // 更新平仓方式
        function updateCloseType() {
            const openType = document.getElementById('open-type').value;
            document.getElementById('close-type').value = openType === 'long' ? '多平' : '空平';
        }
      
        // 计算一手保证金
        function calculateMargin() {
            const futuresCode = document.getElementById('futures-type').value;
            const marginRate = parseFloat(document.getElementById('margin-rate').value) / 100;
            const capital = parseFloat(document.getElementById('capital').value);
            const openPrice = parseFloat(document.getElementById('open-price').value);
          
            const future = futuresData.find(f => f.code === futuresCode);
            if (!future) return;
          
            // 计算一手保证金
            const marginPerLot = openPrice * future.multiplier * marginRate;
            document.getElementById('margin-per-lot').textContent = marginPerLot.toFixed(2);
          
            // 计算最大可买手数
            const maxLots = Math.floor(capital / marginPerLot);
            document.getElementById('max-lots').textContent = maxLots;
          
            // 显示计算结果
            document.getElementById('calculation-info').style.display = 'block';
          
            // 显示不足一手警告
            if (maxLots < 1) {
                document.getElementById('insufficient-warning').style.display = 'block';
            } else {
                document.getElementById('insufficient-warning').style.display = 'none';
            }
        }
      
        // 计算回测结果
        function calculateResults() {
            // 隐藏占位符，显示结果
            document.getElementById('result-placeholder').style.display = 'none';
            document.getElementById('result-content').style.display = 'block';
          
            // 获取输入值
            const futuresCode = document.getElementById('futures-type').value;
            const openType = document.getElementById('open-type').value;
            const marginRate = parseFloat(document.getElementById('margin-rate').value) / 100;
            const capital = parseFloat(document.getElementById('capital').value);
            const openPrice = parseFloat(document.getElementById('open-price').value);
            const closePrice = parseFloat(document.getElementById('close-price').value);
            const addMarginType = document.getElementById('add-margin-type').value;
          
            const future = futuresData.find(f => f.code === futuresCode);
            if (!future) return;
          
            // 计算初始参数
            const marginPerLot = openPrice * future.multiplier * marginRate;
            const maxLots = Math.floor(capital / marginPerLot);
          
            // 检查是否可交易
            if (maxLots < 1) {
                alert("可用资金不足购买一手，请调整参数！");
                return;
            }
          
            // 方向系数（多开为1，空开为-1）
            const direction = openType === 'long' ? 1 : -1;
          
            // 初始化变量
            let currentPrice = openPrice;
            let profit = 0;
            let cumulativeProfit = 0;
            let totalProfit = 0;
            let totalLots = maxLots;
            let addMarginCount = 0;
          
            // 清空表格
            const tableBody = document.querySelector('#result-table tbody');
            tableBody.innerHTML = '';
          
            // 添加初始仓位行
            const initialProfit = (closePrice - openPrice) * future.multiplier * maxLots * direction;
            totalProfit += initialProfit;
            cumulativeProfit = initialProfit;
          
            addTableRow(tableBody, "初始开仓", openPrice, maxLots, closePrice, initialProfit, cumulativeProfit, "-");
          
            // 根据加仓方式计算加仓
            if (addMarginType === 'pyramid') {
                // 倒金字塔加仓：加仓次数递减
                const priceChange = (closePrice - openPrice) * direction;
                const steps = Math.min(Math.floor(Math.abs(priceChange) / (openPrice * 0.05)), 4);
              
                for (let i = 1; i <= steps; i++) {
                    addMarginCount++;
                    const stepSize = (steps - i + 1) / (steps * (steps + 1) / 2);
                    const addLots = Math.max(1, Math.floor(maxLots * stepSize));
                  
                    const addOpenPrice = openPrice + (closePrice - openPrice) * (i / (steps + 1));
                    const addProfit = (closePrice - addOpenPrice) * future.multiplier * addLots * direction;
                  
                    totalProfit += addProfit;
                    cumulativeProfit += addProfit;
                    totalLots += addLots;
                  
                    addTableRow(tableBody, `加仓 ${i}`, addOpenPrice, addLots, closePrice, 
                                addProfit, cumulativeProfit, "倒金字塔加仓");
                }
            } else {
                // 每涨10%加仓
                const priceChange = (closePrice - openPrice) * direction;
                const minChange = openPrice * 0.1;
                let changeAmount = minChange;
                let addCount = 0;
              
                while (Math.abs(priceChange) > changeAmount && addCount < 5) {
                    addCount++;
                    addMarginCount++;
                  
                    const addOpenPrice = openPrice + minChange * direction * addCount;
                    const addLots = Math.max(1, Math.floor(maxLots * 0.5));
                    const addProfit = (closePrice - addOpenPrice) * future.multiplier * addLots * direction;
                  
                    totalProfit += addProfit;
                    cumulativeProfit += addProfit;
                    totalLots += addLots;
                  
                    addTableRow(tableBody, `加仓 ${addCount}`, addOpenPrice, addLots, closePrice, 
                                addProfit, cumulativeProfit, "每涨10%加仓");
                  
                    changeAmount += minChange;
                }
            }
          
            // 更新汇总信息
            const finalValue = capital + totalProfit;
            const returnRate = ((finalValue - capital) / capital * 100).toFixed(2);
          
            document.getElementById('initial-capital').textContent = capital.toFixed(2) + " 元";
            document.getElementById('final-value').textContent = finalValue.toFixed(2) + " 元";
            document.getElementById('total-profit').textContent = totalProfit.toFixed(2) + " 元";
            document.getElementById('return-rate').textContent = returnRate + "%";
          
            // 设置颜色
            document.getElementById('total-profit').className = totalProfit >= 0 ? 
                "summary-value positive" : "summary-value negative";
            document.getElementById('return-rate').className = parseFloat(returnRate) >= 0 ? 
                "summary-value positive" : "summary-value negative";
        }
      
        // 添加表格行
        function addTableRow(tableBody, operation, openPrice, lots, closePrice, profit, cumulative, method) {
            const row = tableBody.insertRow();
          
            row.insertCell(0).textContent = operation;
            row.insertCell(1).textContent = openPrice.toFixed(2);
            row.insertCell(2).textContent = lots;
            row.insertCell(3).textContent = closePrice.toFixed(2);
          
            const profitCell = row.insertCell(4);
            profitCell.textContent = profit.toFixed(2);
            profitCell.className = profit >= 0 ? "profit-positive" : "profit-negative";
          
            const cumulativeCell = row.insertCell(5);
            cumulativeCell.textContent = cumulative.toFixed(2);
            cumulativeCell.className = cumulative >= 0 ? "profit-positive" : "profit-negative";
          
            row.insertCell(6).textContent = method;
        }
    </script>
</body>
</html>
